{"ast":null,"code":"import { __assign, __awaiter, __extends, __generator, __rest } from \"tslib\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Textarea from 'react-textarea-autosize';\nimport getCaretCoordinates from 'textarea-caret';\nimport { isValidElementType } from 'react-is';\nimport clsx from 'clsx';\nimport { List as DefaultSuggestionList } from './List';\nimport { DEFAULT_CARET_POSITION, defaultScrollToItem, errorMessage, triggerPropsCheck } from './utils';\nimport { CommandItem } from '../CommandItem';\nimport { UserItem } from '../UserItem';\nimport { isSafari } from '../../utils/browsers';\nvar ReactTextareaAutocomplete = /** @class */function (_super) {\n  __extends(ReactTextareaAutocomplete, _super);\n  function ReactTextareaAutocomplete(props) {\n    var _this = _super.call(this, props) || this;\n    // FIXME: unused method\n    _this.getSelectionPosition = function () {\n      if (!_this.textareaRef) return null;\n      return {\n        selectionEnd: _this.textareaRef.selectionEnd,\n        selectionStart: _this.textareaRef.selectionStart\n      };\n    };\n    // FIXME: unused method\n    _this.getSelectedText = function () {\n      if (!_this.textareaRef) return null;\n      var _a = _this.textareaRef,\n        selectionEnd = _a.selectionEnd,\n        selectionStart = _a.selectionStart;\n      if (selectionStart === selectionEnd) return null;\n      return _this.state.value.substr(selectionStart, selectionEnd - selectionStart);\n    };\n    _this.setCaretPosition = function (position) {\n      if (position === void 0) {\n        position = 0;\n      }\n      if (!_this.textareaRef) return;\n      _this.textareaRef.focus();\n      _this.textareaRef.setSelectionRange(position, position);\n    };\n    _this.getCaretPosition = function () {\n      if (!_this.textareaRef) return 0;\n      return _this.textareaRef.selectionEnd;\n    };\n    /**\n     * isComposing prevents double submissions in Korean and other languages.\n     * starting point for a read:\n     * https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/isComposing\n     * In the long term, the fix should happen by handling keypress, but changing this has unknown implications.\n     * @param event React.KeyboardEvent\n     */\n    _this._defaultShouldSubmit = function (event) {\n      return event.key === 'Enter' && !event.shiftKey && !event.nativeEvent.isComposing;\n    };\n    _this._handleKeyDown = function (event) {\n      var _a = _this.props.shouldSubmit,\n        shouldSubmit = _a === void 0 ? _this._defaultShouldSubmit : _a;\n      // prevent default behaviour when the selection list is rendered\n      if ((event.key === 'ArrowUp' || event.key === 'ArrowDown') && _this.dropdownRef) event.preventDefault();\n      if (shouldSubmit === null || shouldSubmit === void 0 ? void 0 : shouldSubmit(event)) return _this._onEnter(event);\n      if (event.key === ' ') return _this._onSpace(event);\n      if (event.key === 'Escape') return _this._closeAutocomplete();\n    };\n    _this._onEnter = function (event) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var trigger;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!this.textareaRef) return [2 /*return*/];\n              trigger = this.state.currentTrigger;\n              if (!(!trigger || !this.state.data)) return [3 /*break*/, 2];\n              // trigger a submit\n              return [4 /*yield*/, this._replaceWord()];\n            case 1:\n              // trigger a submit\n              _a.sent();\n              if (this.textareaRef) {\n                this.textareaRef.selectionEnd = 0;\n              }\n              this.props.handleSubmit(event);\n              this._closeAutocomplete();\n              _a.label = 2;\n            case 2:\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n    _this._onSpace = function () {\n      if (!_this.props.replaceWord || !_this.textareaRef) return;\n      // don't change characters if the element doesn't have focus\n      var hasFocus = _this.textareaRef.matches(':focus');\n      if (!hasFocus) return;\n      _this._replaceWord();\n    };\n    _this._replaceWord = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var value, lastWordRegex, match, lastWord, spaces, newWord, textBeforeWord, textAfterCaret, newText;\n        var _this = this;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              value = this.state.value;\n              lastWordRegex = /([^\\s]+)(\\s*)$/;\n              match = lastWordRegex.exec(value.slice(0, this.getCaretPosition()));\n              lastWord = match && match[1];\n              if (!lastWord) return [2 /*return*/];\n              spaces = match[2];\n              return [4 /*yield*/, this.props.replaceWord(lastWord)];\n            case 1:\n              newWord = _a.sent();\n              if (newWord == null) return [2 /*return*/];\n              textBeforeWord = value.slice(0, this.getCaretPosition() - match[0].length);\n              textAfterCaret = value.slice(this.getCaretPosition(), -1);\n              newText = textBeforeWord + newWord + spaces + textAfterCaret;\n              this.setState({\n                value: newText\n              }, function () {\n                // fire onChange event after successful selection\n                var e = new CustomEvent('change', {\n                  bubbles: true\n                });\n                _this.textareaRef.dispatchEvent(e);\n                if (_this.props.onChange) _this.props.onChange(e);\n              });\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n    _this._onSelect = function (newToken) {\n      var _a = _this.props,\n        closeCommandsList = _a.closeCommandsList,\n        closeMentionsList = _a.closeMentionsList,\n        onChange = _a.onChange,\n        showCommandsList = _a.showCommandsList,\n        showMentionsList = _a.showMentionsList;\n      var _b = _this.state,\n        stateTrigger = _b.currentTrigger,\n        selectionEnd = _b.selectionEnd,\n        textareaValue = _b.value;\n      var currentTrigger = showCommandsList ? '/' : showMentionsList ? '@' : stateTrigger;\n      if (!currentTrigger) return;\n      var computeCaretPosition = function (position, token, startToken) {\n        switch (position) {\n          case 'start':\n            return startToken;\n          case 'next':\n          case 'end':\n            return startToken + token.length;\n          default:\n            if (!Number.isInteger(position)) {\n              throw new Error('RTA: caretPosition should be \"start\", \"next\", \"end\" or number.');\n            }\n            return position;\n        }\n      };\n      var textToModify = showCommandsList ? '/' : showMentionsList ? '@' : textareaValue.slice(0, selectionEnd);\n      var startOfTokenPosition = textToModify.lastIndexOf(currentTrigger);\n      // we add space after emoji is selected if a caret position is next\n      var newTokenString = newToken.caretPosition === 'next' ? \"\".concat(newToken.text, \" \") : newToken.text;\n      var newCaretPosition = computeCaretPosition(newToken.caretPosition, newTokenString, startOfTokenPosition);\n      var modifiedText = textToModify.substring(0, startOfTokenPosition) + newTokenString;\n      var valueToReplace = textareaValue.replace(textToModify, modifiedText);\n      // set the new textarea value and after that set the caret back to its position\n      _this.setState({\n        dataLoading: false,\n        value: valueToReplace\n      }, function () {\n        // fire onChange event after successful selection\n        var e = new CustomEvent('change', {\n          bubbles: true\n        });\n        _this.textareaRef.dispatchEvent(e);\n        if (onChange) onChange(e);\n        _this.setCaretPosition(newCaretPosition);\n      });\n      _this._closeAutocomplete();\n      if (showCommandsList) closeCommandsList();\n      if (showMentionsList) closeMentionsList();\n    };\n    _this._getItemOnSelect = function (paramTrigger) {\n      var stateTrigger = _this.state.currentTrigger;\n      var triggerSettings = _this._getCurrentTriggerSettings(paramTrigger);\n      var currentTrigger = paramTrigger || stateTrigger;\n      if (!currentTrigger || !triggerSettings) return null;\n      var callback = triggerSettings.callback;\n      if (!callback) return null;\n      return function (item) {\n        if (typeof callback !== 'function') {\n          throw new Error('Output functor is not defined! You have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n        }\n        if (callback) {\n          return callback(item, currentTrigger);\n        }\n        return null;\n      };\n    };\n    _this._getTextToReplace = function (paramTrigger) {\n      var _a = _this.state,\n        actualToken = _a.actualToken,\n        stateTrigger = _a.currentTrigger;\n      var triggerSettings = _this._getCurrentTriggerSettings(paramTrigger);\n      var currentTrigger = paramTrigger || stateTrigger;\n      if (!currentTrigger || !triggerSettings) return null;\n      var output = triggerSettings.output;\n      return function (item) {\n        if (typeof item === 'object' && (!output || typeof output !== 'function')) {\n          throw new Error('Output functor is not defined! If you are using items as object you have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n        }\n        if (output) {\n          var textToReplace = output(item, currentTrigger);\n          if (!textToReplace || typeof textToReplace === 'number') {\n            throw new Error(\"Output functor should return string or object in shape {text: string, caretPosition: string | number}.\\nGot \\\"\".concat(String(textToReplace), \"\\\". Check the implementation for trigger \\\"\").concat(currentTrigger, \"\\\" and its token \\\"\").concat(actualToken, \"\\\"\\n\\nSee https://github.com/webscopeio/react-textarea-autocomplete#trigger-type for more informations.\\n\"));\n          }\n          if (typeof textToReplace === 'string') {\n            return {\n              caretPosition: DEFAULT_CARET_POSITION,\n              text: textToReplace\n            };\n          }\n          if (!textToReplace.text && currentTrigger !== ':') {\n            throw new Error(\"Output \\\"text\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\".concat(currentTrigger, \"\\\" and its token \\\"\").concat(actualToken, \"\\\"\\n\"));\n          }\n          if (!textToReplace.caretPosition) {\n            throw new Error(\"Output \\\"caretPosition\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\".concat(currentTrigger, \"\\\" and its token \\\"\").concat(actualToken, \"\\\"\\n\"));\n          }\n          return textToReplace;\n        }\n        if (typeof item !== 'string') {\n          throw new Error('Output item should be string\\n');\n        }\n        return {\n          caretPosition: DEFAULT_CARET_POSITION,\n          text: \"\".concat(currentTrigger).concat(item).concat(currentTrigger)\n        };\n      };\n    };\n    _this._getCurrentTriggerSettings = function (paramTrigger) {\n      var stateTrigger = _this.state.currentTrigger;\n      var currentTrigger = paramTrigger || stateTrigger;\n      if (!currentTrigger) return null;\n      return _this.props.trigger[currentTrigger];\n    };\n    _this._getValuesFromProvider = function () {\n      var _a = _this.state,\n        actualToken = _a.actualToken,\n        currentTrigger = _a.currentTrigger;\n      var triggerSettings = _this._getCurrentTriggerSettings();\n      if (!currentTrigger || !triggerSettings) return;\n      var component = triggerSettings.component,\n        dataProvider = triggerSettings.dataProvider;\n      if (typeof dataProvider !== 'function') {\n        throw new Error('Trigger provider has to be a function!');\n      }\n      _this.setState({\n        dataLoading: true\n      });\n      // Modified: send the full text to support / style commands\n      dataProvider(actualToken, _this.state.value, function (data, token) {\n        // Make sure that the result is still relevant for current query\n        if (token !== _this.state.actualToken) return;\n        if (!Array.isArray(data)) {\n          throw new Error('Trigger provider has to provide an array!');\n        }\n        if (!isValidElementType(component)) {\n          throw new Error('Component should be defined!');\n        }\n        // throw away if we resolved old trigger\n        if (currentTrigger !== _this.state.currentTrigger) return;\n        // if we haven't resolved any data let's close the autocomplete\n        if (!data.length) {\n          _this._closeAutocomplete();\n          return;\n        }\n        _this.setState({\n          component: component,\n          data: data,\n          dataLoading: false\n        });\n      });\n    };\n    _this._getSuggestions = function (paramTrigger) {\n      var _a = _this.state,\n        stateTrigger = _a.currentTrigger,\n        data = _a.data;\n      var currentTrigger = paramTrigger || stateTrigger;\n      if (!currentTrigger || !data || data && !data.length) return null;\n      return data;\n    };\n    /**\n     * Close autocomplete, also clean up trigger (to avoid slow promises)\n     */\n    _this._closeAutocomplete = function () {\n      _this.setState({\n        currentTrigger: null,\n        data: null,\n        dataLoading: false,\n        left: null,\n        top: null\n      });\n    };\n    _this._cleanUpProps = function () {\n      var props = __assign({}, _this.props);\n      var notSafe = ['additionalTextareaProps', 'className', 'closeCommandsList', 'closeMentionsList', 'closeOnClickOutside', 'containerClassName', 'containerStyle', 'disableMentions', 'dropdownClassName', 'dropdownStyle', 'grow', 'handleSubmit', 'innerRef', 'itemClassName', 'itemStyle', 'listClassName', 'listStyle', 'loaderClassName', 'loaderStyle', 'loadingComponent', 'minChar', 'movePopupAsYouType', 'onCaretPositionChange', 'onChange', 'ref', 'replaceWord', 'scrollToItem', 'shouldSubmit', 'showCommandsList', 'showMentionsList', 'SuggestionItem', 'SuggestionList', 'trigger', 'value'];\n      // eslint-disable-next-line\n      for (var prop in props) {\n        if (notSafe.includes(prop)) delete props[prop];\n      }\n      return props;\n    };\n    _this._isCommand = function (text) {\n      if (text[0] !== '/') return false;\n      var tokens = text.split(' ');\n      return tokens.length <= 1;\n    };\n    _this._changeHandler = function (e) {\n      var _a = _this.props,\n        minChar = _a.minChar,\n        movePopupAsYouType = _a.movePopupAsYouType,\n        onCaretPositionChange = _a.onCaretPositionChange,\n        onChange = _a.onChange,\n        trigger = _a.trigger;\n      var _b = _this.state,\n        left = _b.left,\n        top = _b.top;\n      var textarea = e.target;\n      var selectionEnd = textarea.selectionEnd,\n        selectionStart = textarea.selectionStart,\n        value = textarea.value;\n      if (onChange) {\n        e.persist();\n        onChange(e);\n      }\n      if (onCaretPositionChange) onCaretPositionChange(_this.getCaretPosition());\n      _this.setState({\n        value: value\n      });\n      var currentTrigger;\n      var lastToken;\n      if (_this._isCommand(value)) {\n        currentTrigger = '/';\n        lastToken = value;\n      } else {\n        var triggerTokens = Object.keys(trigger).join().replace('/', '');\n        var triggerNorWhitespace = \"[^\\\\s\".concat(triggerTokens, \"]*\");\n        var regex = new RegExp(\"(?!^|\\\\W)?[\".concat(triggerTokens, \"]\").concat(triggerNorWhitespace, \"\\\\s?\").concat(triggerNorWhitespace, \"$\"), 'g');\n        var tokenMatch = value.slice(0, selectionEnd).match(regex);\n        lastToken = tokenMatch && tokenMatch[tokenMatch.length - 1].trim();\n        currentTrigger = lastToken && Object.keys(trigger).find(function (a) {\n          return a === lastToken[0];\n        }) || null;\n      }\n      /*\n       if we lost the trigger token or there is no following character we want to close\n       the autocomplete\n      */\n      if (!lastToken || lastToken.length <= minChar) {\n        _this._closeAutocomplete();\n        return;\n      }\n      var actualToken = lastToken.slice(1);\n      // if trigger is not configured step out from the function, otherwise proceed\n      if (!currentTrigger) return;\n      if (movePopupAsYouType || top === null && left === null ||\n      // if we have single char - trigger it means we want to re-position the autocomplete\n      lastToken.length === 1) {\n        var _c = getCaretCoordinates(textarea, selectionEnd),\n          newLeft = _c.left,\n          newTop = _c.top;\n        _this.setState({\n          // make position relative to textarea\n          left: newLeft,\n          top: newTop - _this.textareaRef.scrollTop || 0\n        });\n      }\n      _this.setState({\n        actualToken: actualToken,\n        currentTrigger: currentTrigger,\n        selectionEnd: selectionEnd,\n        selectionStart: selectionStart\n      }, function () {\n        try {\n          _this._getValuesFromProvider();\n        } catch (err) {\n          errorMessage(err.message);\n        }\n      });\n    };\n    _this._selectHandler = function (e) {\n      var _a = _this.props,\n        onCaretPositionChange = _a.onCaretPositionChange,\n        onSelect = _a.onSelect;\n      if (onCaretPositionChange) onCaretPositionChange(_this.getCaretPosition());\n      if (onSelect) {\n        e.persist();\n        onSelect(e);\n      }\n    };\n    // The textarea itself is outside the auto-select dropdown.\n    _this._onClickAndBlurHandler = function (e) {\n      var _a = _this.props,\n        closeOnClickOutside = _a.closeOnClickOutside,\n        onBlur = _a.onBlur;\n      // If this is a click: e.target is the textarea, and e.relatedTarget is the thing\n      // that was actually clicked. If we clicked inside the auto-select dropdown, then\n      // that's not a blur, from the auto-select point of view, so then do nothing.\n      var el = e.relatedTarget;\n      // If this is a blur event in Safari, then relatedTarget is never a dropdown item, but a common parent\n      // of textarea and dropdown container. That means that dropdownRef will not contain its parent and the\n      // autocomplete will be closed before onclick handler can be invoked selecting an item.\n      // It seems that Safari has different implementation determining the relatedTarget node than Chrome and Firefox.\n      // Therefore, if focused away in Safari, the dropdown will be kept rendered until pressing Esc or selecting and item from it.\n      var focusedAwayInSafari = isSafari() && e.type === 'blur';\n      if (_this.dropdownRef && el instanceof Node && _this.dropdownRef.contains(el) || focusedAwayInSafari) {\n        return;\n      }\n      if (closeOnClickOutside) _this._closeAutocomplete();\n      if (onBlur) {\n        e.persist();\n        onBlur(e);\n      }\n    };\n    _this._onScrollHandler = function () {\n      return _this._closeAutocomplete();\n    };\n    _this._dropdownScroll = function (item) {\n      var scrollToItem = _this.props.scrollToItem;\n      if (!scrollToItem) return;\n      if (scrollToItem === true) {\n        defaultScrollToItem(_this.dropdownRef, item);\n        return;\n      }\n      if (typeof scrollToItem !== 'function' || scrollToItem.length !== 2) {\n        throw new Error('`scrollToItem` has to be boolean (true for default implementation) or function with two parameters: container, item.');\n      }\n      scrollToItem(_this.dropdownRef, item);\n    };\n    _this.getTriggerProps = function () {\n      var _a = _this.props,\n        showCommandsList = _a.showCommandsList,\n        showMentionsList = _a.showMentionsList,\n        trigger = _a.trigger;\n      var _b = _this.state,\n        component = _b.component,\n        currentTrigger = _b.currentTrigger,\n        selectionEnd = _b.selectionEnd,\n        value = _b.value;\n      var selectedItem = _this._getItemOnSelect();\n      var suggestionData = _this._getSuggestions();\n      var textToReplace = _this._getTextToReplace();\n      var triggerProps = {\n        component: component,\n        currentTrigger: currentTrigger,\n        getSelectedItem: selectedItem,\n        getTextToReplace: textToReplace,\n        selectionEnd: selectionEnd,\n        value: value,\n        values: suggestionData\n      };\n      if (showCommandsList && trigger['/'] || showMentionsList && trigger['@']) {\n        var currentCommands_1;\n        var getCommands = trigger[showCommandsList ? '/' : '@'].dataProvider;\n        getCommands === null || getCommands === void 0 ? void 0 : getCommands('', showCommandsList ? '/' : '@', function (data) {\n          currentCommands_1 = data;\n        });\n        triggerProps.component = showCommandsList ? CommandItem : UserItem;\n        triggerProps.currentTrigger = showCommandsList ? '/' : '@';\n        triggerProps.getTextToReplace = _this._getTextToReplace(showCommandsList ? '/' : '@');\n        triggerProps.getSelectedItem = _this._getItemOnSelect(showCommandsList ? '/' : '@');\n        triggerProps.selectionEnd = 1;\n        triggerProps.value = showCommandsList ? '/' : '@';\n        triggerProps.values = currentCommands_1;\n      }\n      return triggerProps;\n    };\n    _this.setDropdownRef = function (element) {\n      _this.dropdownRef = element;\n    };\n    var _a = _this.props,\n      loadingComponent = _a.loadingComponent,\n      trigger = _a.trigger,\n      value = _a.value;\n    // TODO: it would be better to have the parent control state...\n    // if (value) this.state.value = value;\n    if (!loadingComponent) {\n      throw new Error('RTA: loadingComponent is not defined');\n    }\n    if (!trigger) {\n      throw new Error('RTA: trigger is not defined');\n    }\n    _this.state = {\n      actualToken: '',\n      component: null,\n      currentTrigger: null,\n      data: null,\n      dataLoading: false,\n      isComposing: false,\n      left: null,\n      selectionEnd: 0,\n      selectionStart: 0,\n      top: null,\n      value: value || ''\n    };\n    return _this;\n  }\n  /**\n   * setup to emulate the UNSAFE_componentWillReceiveProps\n   */\n  ReactTextareaAutocomplete.getDerivedStateFromProps = function (props, state) {\n    if (props.value !== state.propsValue || !state.value) {\n      return {\n        propsValue: props.value,\n        value: props.value\n      };\n    } else {\n      return null;\n    }\n  };\n  ReactTextareaAutocomplete.prototype.renderSuggestionListContainer = function () {\n    var _a = this.props,\n      disableMentions = _a.disableMentions,\n      dropdownClassName = _a.dropdownClassName,\n      dropdownStyle = _a.dropdownStyle,\n      itemClassName = _a.itemClassName,\n      itemStyle = _a.itemStyle,\n      listClassName = _a.listClassName,\n      SuggestionItem = _a.SuggestionItem,\n      _b = _a.SuggestionList,\n      SuggestionList = _b === void 0 ? DefaultSuggestionList : _b;\n    var isComposing = this.state.isComposing;\n    var triggerProps = this.getTriggerProps();\n    if (isComposing || !triggerProps.values || !triggerProps.currentTrigger || disableMentions && triggerProps.currentTrigger === '@') return null;\n    return React.createElement(\"div\", {\n      className: clsx('rta__autocomplete', 'str-chat__suggestion-list-container', dropdownClassName),\n      ref: this.setDropdownRef,\n      style: dropdownStyle\n    }, React.createElement(SuggestionList, __assign({\n      className: clsx('str-chat__suggestion-list', listClassName),\n      dropdownScroll: this._dropdownScroll,\n      itemClassName: clsx('str-chat__suggestion-list-item', itemClassName),\n      itemStyle: itemStyle,\n      onSelect: this._onSelect,\n      SuggestionItem: SuggestionItem\n    }, triggerProps)));\n  };\n  ReactTextareaAutocomplete.prototype.render = function () {\n    var _this = this;\n    var _a = this.props,\n      className = _a.className,\n      containerClassName = _a.containerClassName,\n      containerStyle = _a.containerStyle,\n      style = _a.style;\n    var _b = this.props.additionalTextareaProps || {},\n      onBlur = _b.onBlur,\n      onChange = _b.onChange,\n      onClick = _b.onClick,\n      onFocus = _b.onFocus,\n      onKeyDown = _b.onKeyDown,\n      onScroll = _b.onScroll,\n      onSelect = _b.onSelect,\n      restAdditionalTextareaProps = __rest(_b, [\"onBlur\", \"onChange\", \"onClick\", \"onFocus\", \"onKeyDown\", \"onScroll\", \"onSelect\"]);\n    var maxRows = this.props.maxRows;\n    var _c = this.state,\n      dataLoading = _c.dataLoading,\n      value = _c.value;\n    if (!this.props.grow) maxRows = 1;\n    // By setting defaultValue to undefined, avoid error:\n    // ForwardRef(TextareaAutosize) contains a textarea with both value and defaultValue props.\n    // Textarea elements must be either controlled or uncontrolled\n    return React.createElement(\"div\", {\n      className: clsx('rta', containerClassName, {\n        'rta--loading': dataLoading\n      }),\n      style: containerStyle\n    }, this.renderSuggestionListContainer(), React.createElement(Textarea, __assign({\n      \"data-testid\": 'message-input'\n    }, this._cleanUpProps(), {\n      className: clsx('rta__textarea', className),\n      maxRows: maxRows,\n      onBlur: function (e) {\n        _this._onClickAndBlurHandler(e);\n        onBlur === null || onBlur === void 0 ? void 0 : onBlur(e);\n      },\n      onChange: function (e) {\n        _this._changeHandler(e);\n        onChange === null || onChange === void 0 ? void 0 : onChange(e);\n      },\n      onClick: function (e) {\n        _this._onClickAndBlurHandler(e);\n        onClick === null || onClick === void 0 ? void 0 : onClick(e);\n      },\n      onCompositionEnd: function () {\n        return _this.setState(function (pv) {\n          return __assign(__assign({}, pv), {\n            isComposing: false\n          });\n        });\n      },\n      onCompositionStart: function () {\n        return _this.setState(function (pv) {\n          return __assign(__assign({}, pv), {\n            isComposing: true\n          });\n        });\n      },\n      onFocus: function (e) {\n        var _a, _b;\n        (_b = (_a = _this.props).onFocus) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n        onFocus === null || onFocus === void 0 ? void 0 : onFocus(e);\n      },\n      onKeyDown: function (e) {\n        _this._handleKeyDown(e);\n        onKeyDown === null || onKeyDown === void 0 ? void 0 : onKeyDown(e);\n      },\n      onScroll: function (e) {\n        _this._onScrollHandler(e);\n        onScroll === null || onScroll === void 0 ? void 0 : onScroll(e);\n      },\n      onSelect: function (e) {\n        _this._selectHandler(e);\n        onSelect === null || onSelect === void 0 ? void 0 : onSelect(e);\n      },\n      ref: function (ref) {\n        var _a;\n        (_a = _this.props) === null || _a === void 0 ? void 0 : _a.innerRef(ref);\n        _this.textareaRef = ref;\n      },\n      style: style,\n      value: value\n    }, restAdditionalTextareaProps, {\n      defaultValue: undefined\n    })));\n  };\n  ReactTextareaAutocomplete.defaultProps = {\n    closeOnClickOutside: true,\n    maxRows: 10,\n    minChar: 1,\n    movePopupAsYouType: false,\n    scrollToItem: true,\n    value: ''\n  };\n  return ReactTextareaAutocomplete;\n}(React.Component);\nexport { ReactTextareaAutocomplete };\nReactTextareaAutocomplete.propTypes = {\n  className: PropTypes.string,\n  closeOnClickOutside: PropTypes.bool,\n  containerClassName: PropTypes.string,\n  containerStyle: PropTypes.object,\n  disableMentions: PropTypes.bool,\n  dropdownClassName: PropTypes.string,\n  dropdownStyle: PropTypes.object,\n  itemClassName: PropTypes.string,\n  itemStyle: PropTypes.object,\n  listClassName: PropTypes.string,\n  listStyle: PropTypes.object,\n  loaderClassName: PropTypes.string,\n  loaderStyle: PropTypes.object,\n  loadingComponent: PropTypes.elementType,\n  minChar: PropTypes.number,\n  onBlur: PropTypes.func,\n  onCaretPositionChange: PropTypes.func,\n  onChange: PropTypes.func,\n  onSelect: PropTypes.func,\n  shouldSubmit: PropTypes.func,\n  style: PropTypes.object,\n  SuggestionList: PropTypes.elementType,\n  trigger: triggerPropsCheck,\n  value: PropTypes.string\n};","map":{"version":3,"names":["__assign","__awaiter","__extends","__generator","__rest","React","PropTypes","Textarea","getCaretCoordinates","isValidElementType","clsx","List","DefaultSuggestionList","DEFAULT_CARET_POSITION","defaultScrollToItem","errorMessage","triggerPropsCheck","CommandItem","UserItem","isSafari","ReactTextareaAutocomplete","_super","props","_this","call","getSelectionPosition","textareaRef","selectionEnd","selectionStart","getSelectedText","_a","state","value","substr","setCaretPosition","position","focus","setSelectionRange","getCaretPosition","_defaultShouldSubmit","event","key","shiftKey","nativeEvent","isComposing","_handleKeyDown","shouldSubmit","dropdownRef","preventDefault","_onEnter","_onSpace","_closeAutocomplete","trigger","label","currentTrigger","data","_replaceWord","sent","handleSubmit","replaceWord","hasFocus","matches","lastWordRegex","match","lastWord","spaces","newWord","textBeforeWord","textAfterCaret","newText","exec","slice","length","setState","e","CustomEvent","bubbles","dispatchEvent","onChange","_onSelect","newToken","closeCommandsList","closeMentionsList","showCommandsList","showMentionsList","_b","stateTrigger","textareaValue","computeCaretPosition","token","startToken","Number","isInteger","Error","textToModify","startOfTokenPosition","lastIndexOf","newTokenString","caretPosition","concat","text","newCaretPosition","modifiedText","substring","valueToReplace","replace","dataLoading","_getItemOnSelect","paramTrigger","triggerSettings","_getCurrentTriggerSettings","callback","item","_getTextToReplace","actualToken","output","textToReplace","String","_getValuesFromProvider","component","dataProvider","Array","isArray","_getSuggestions","left","top","_cleanUpProps","notSafe","prop","includes","_isCommand","tokens","split","_changeHandler","minChar","movePopupAsYouType","onCaretPositionChange","textarea","target","persist","lastToken","triggerTokens","Object","keys","join","triggerNorWhitespace","regex","RegExp","tokenMatch","trim","find","a","_c","newLeft","newTop","scrollTop","err","message","_selectHandler","onSelect","_onClickAndBlurHandler","closeOnClickOutside","onBlur","el","relatedTarget","focusedAwayInSafari","type","Node","contains","_onScrollHandler","_dropdownScroll","scrollToItem","getTriggerProps","selectedItem","suggestionData","triggerProps","getSelectedItem","getTextToReplace","values","currentCommands_1","getCommands","setDropdownRef","element","loadingComponent","getDerivedStateFromProps","propsValue","prototype","renderSuggestionListContainer","disableMentions","dropdownClassName","dropdownStyle","itemClassName","itemStyle","listClassName","SuggestionItem","SuggestionList","createElement","className","ref","style","dropdownScroll","render","containerClassName","containerStyle","additionalTextareaProps","onClick","onFocus","onKeyDown","onScroll","restAdditionalTextareaProps","maxRows","grow","onCompositionEnd","pv","onCompositionStart","innerRef","defaultValue","undefined","defaultProps","Component","propTypes","string","bool","object","listStyle","loaderClassName","loaderStyle","elementType","number","func"],"sources":["C:/Users/Gesti/Desktop/chat_application/client/node_modules/stream-chat-react/dist/components/AutoCompleteTextarea/Textarea.js"],"sourcesContent":["import { __assign, __awaiter, __extends, __generator, __rest } from \"tslib\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Textarea from 'react-textarea-autosize';\nimport getCaretCoordinates from 'textarea-caret';\nimport { isValidElementType } from 'react-is';\nimport clsx from 'clsx';\nimport { List as DefaultSuggestionList } from './List';\nimport { DEFAULT_CARET_POSITION, defaultScrollToItem, errorMessage, triggerPropsCheck, } from './utils';\nimport { CommandItem } from '../CommandItem';\nimport { UserItem } from '../UserItem';\nimport { isSafari } from '../../utils/browsers';\nvar ReactTextareaAutocomplete = /** @class */ (function (_super) {\n    __extends(ReactTextareaAutocomplete, _super);\n    function ReactTextareaAutocomplete(props) {\n        var _this = _super.call(this, props) || this;\n        // FIXME: unused method\n        _this.getSelectionPosition = function () {\n            if (!_this.textareaRef)\n                return null;\n            return {\n                selectionEnd: _this.textareaRef.selectionEnd,\n                selectionStart: _this.textareaRef.selectionStart,\n            };\n        };\n        // FIXME: unused method\n        _this.getSelectedText = function () {\n            if (!_this.textareaRef)\n                return null;\n            var _a = _this.textareaRef, selectionEnd = _a.selectionEnd, selectionStart = _a.selectionStart;\n            if (selectionStart === selectionEnd)\n                return null;\n            return _this.state.value.substr(selectionStart, selectionEnd - selectionStart);\n        };\n        _this.setCaretPosition = function (position) {\n            if (position === void 0) { position = 0; }\n            if (!_this.textareaRef)\n                return;\n            _this.textareaRef.focus();\n            _this.textareaRef.setSelectionRange(position, position);\n        };\n        _this.getCaretPosition = function () {\n            if (!_this.textareaRef)\n                return 0;\n            return _this.textareaRef.selectionEnd;\n        };\n        /**\n         * isComposing prevents double submissions in Korean and other languages.\n         * starting point for a read:\n         * https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/isComposing\n         * In the long term, the fix should happen by handling keypress, but changing this has unknown implications.\n         * @param event React.KeyboardEvent\n         */\n        _this._defaultShouldSubmit = function (event) {\n            return event.key === 'Enter' && !event.shiftKey && !event.nativeEvent.isComposing;\n        };\n        _this._handleKeyDown = function (event) {\n            var _a = _this.props.shouldSubmit, shouldSubmit = _a === void 0 ? _this._defaultShouldSubmit : _a;\n            // prevent default behaviour when the selection list is rendered\n            if ((event.key === 'ArrowUp' || event.key === 'ArrowDown') && _this.dropdownRef)\n                event.preventDefault();\n            if (shouldSubmit === null || shouldSubmit === void 0 ? void 0 : shouldSubmit(event))\n                return _this._onEnter(event);\n            if (event.key === ' ')\n                return _this._onSpace(event);\n            if (event.key === 'Escape')\n                return _this._closeAutocomplete();\n        };\n        _this._onEnter = function (event) { return __awaiter(_this, void 0, void 0, function () {\n            var trigger;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.textareaRef)\n                            return [2 /*return*/];\n                        trigger = this.state.currentTrigger;\n                        if (!(!trigger || !this.state.data)) return [3 /*break*/, 2];\n                        // trigger a submit\n                        return [4 /*yield*/, this._replaceWord()];\n                    case 1:\n                        // trigger a submit\n                        _a.sent();\n                        if (this.textareaRef) {\n                            this.textareaRef.selectionEnd = 0;\n                        }\n                        this.props.handleSubmit(event);\n                        this._closeAutocomplete();\n                        _a.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        }); };\n        _this._onSpace = function () {\n            if (!_this.props.replaceWord || !_this.textareaRef)\n                return;\n            // don't change characters if the element doesn't have focus\n            var hasFocus = _this.textareaRef.matches(':focus');\n            if (!hasFocus)\n                return;\n            _this._replaceWord();\n        };\n        _this._replaceWord = function () { return __awaiter(_this, void 0, void 0, function () {\n            var value, lastWordRegex, match, lastWord, spaces, newWord, textBeforeWord, textAfterCaret, newText;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        value = this.state.value;\n                        lastWordRegex = /([^\\s]+)(\\s*)$/;\n                        match = lastWordRegex.exec(value.slice(0, this.getCaretPosition()));\n                        lastWord = match && match[1];\n                        if (!lastWord)\n                            return [2 /*return*/];\n                        spaces = match[2];\n                        return [4 /*yield*/, this.props.replaceWord(lastWord)];\n                    case 1:\n                        newWord = _a.sent();\n                        if (newWord == null)\n                            return [2 /*return*/];\n                        textBeforeWord = value.slice(0, this.getCaretPosition() - match[0].length);\n                        textAfterCaret = value.slice(this.getCaretPosition(), -1);\n                        newText = textBeforeWord + newWord + spaces + textAfterCaret;\n                        this.setState({\n                            value: newText,\n                        }, function () {\n                            // fire onChange event after successful selection\n                            var e = new CustomEvent('change', { bubbles: true });\n                            _this.textareaRef.dispatchEvent(e);\n                            if (_this.props.onChange)\n                                _this.props.onChange(e);\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        }); };\n        _this._onSelect = function (newToken) {\n            var _a = _this.props, closeCommandsList = _a.closeCommandsList, closeMentionsList = _a.closeMentionsList, onChange = _a.onChange, showCommandsList = _a.showCommandsList, showMentionsList = _a.showMentionsList;\n            var _b = _this.state, stateTrigger = _b.currentTrigger, selectionEnd = _b.selectionEnd, textareaValue = _b.value;\n            var currentTrigger = showCommandsList ? '/' : showMentionsList ? '@' : stateTrigger;\n            if (!currentTrigger)\n                return;\n            var computeCaretPosition = function (position, token, startToken) {\n                switch (position) {\n                    case 'start':\n                        return startToken;\n                    case 'next':\n                    case 'end':\n                        return startToken + token.length;\n                    default:\n                        if (!Number.isInteger(position)) {\n                            throw new Error('RTA: caretPosition should be \"start\", \"next\", \"end\" or number.');\n                        }\n                        return position;\n                }\n            };\n            var textToModify = showCommandsList\n                ? '/'\n                : showMentionsList\n                    ? '@'\n                    : textareaValue.slice(0, selectionEnd);\n            var startOfTokenPosition = textToModify.lastIndexOf(currentTrigger);\n            // we add space after emoji is selected if a caret position is next\n            var newTokenString = newToken.caretPosition === 'next' ? \"\".concat(newToken.text, \" \") : newToken.text;\n            var newCaretPosition = computeCaretPosition(newToken.caretPosition, newTokenString, startOfTokenPosition);\n            var modifiedText = textToModify.substring(0, startOfTokenPosition) + newTokenString;\n            var valueToReplace = textareaValue.replace(textToModify, modifiedText);\n            // set the new textarea value and after that set the caret back to its position\n            _this.setState({\n                dataLoading: false,\n                value: valueToReplace,\n            }, function () {\n                // fire onChange event after successful selection\n                var e = new CustomEvent('change', { bubbles: true });\n                _this.textareaRef.dispatchEvent(e);\n                if (onChange)\n                    onChange(e);\n                _this.setCaretPosition(newCaretPosition);\n            });\n            _this._closeAutocomplete();\n            if (showCommandsList)\n                closeCommandsList();\n            if (showMentionsList)\n                closeMentionsList();\n        };\n        _this._getItemOnSelect = function (paramTrigger) {\n            var stateTrigger = _this.state.currentTrigger;\n            var triggerSettings = _this._getCurrentTriggerSettings(paramTrigger);\n            var currentTrigger = paramTrigger || stateTrigger;\n            if (!currentTrigger || !triggerSettings)\n                return null;\n            var callback = triggerSettings.callback;\n            if (!callback)\n                return null;\n            return function (item) {\n                if (typeof callback !== 'function') {\n                    throw new Error('Output functor is not defined! You have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n                }\n                if (callback) {\n                    return callback(item, currentTrigger);\n                }\n                return null;\n            };\n        };\n        _this._getTextToReplace = function (paramTrigger) {\n            var _a = _this.state, actualToken = _a.actualToken, stateTrigger = _a.currentTrigger;\n            var triggerSettings = _this._getCurrentTriggerSettings(paramTrigger);\n            var currentTrigger = paramTrigger || stateTrigger;\n            if (!currentTrigger || !triggerSettings)\n                return null;\n            var output = triggerSettings.output;\n            return function (item) {\n                if (typeof item === 'object' && (!output || typeof output !== 'function')) {\n                    throw new Error('Output functor is not defined! If you are using items as object you have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n                }\n                if (output) {\n                    var textToReplace = output(item, currentTrigger);\n                    if (!textToReplace || typeof textToReplace === 'number') {\n                        throw new Error(\"Output functor should return string or object in shape {text: string, caretPosition: string | number}.\\nGot \\\"\".concat(String(textToReplace), \"\\\". Check the implementation for trigger \\\"\").concat(currentTrigger, \"\\\" and its token \\\"\").concat(actualToken, \"\\\"\\n\\nSee https://github.com/webscopeio/react-textarea-autocomplete#trigger-type for more informations.\\n\"));\n                    }\n                    if (typeof textToReplace === 'string') {\n                        return {\n                            caretPosition: DEFAULT_CARET_POSITION,\n                            text: textToReplace,\n                        };\n                    }\n                    if (!textToReplace.text && currentTrigger !== ':') {\n                        throw new Error(\"Output \\\"text\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\".concat(currentTrigger, \"\\\" and its token \\\"\").concat(actualToken, \"\\\"\\n\"));\n                    }\n                    if (!textToReplace.caretPosition) {\n                        throw new Error(\"Output \\\"caretPosition\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\".concat(currentTrigger, \"\\\" and its token \\\"\").concat(actualToken, \"\\\"\\n\"));\n                    }\n                    return textToReplace;\n                }\n                if (typeof item !== 'string') {\n                    throw new Error('Output item should be string\\n');\n                }\n                return {\n                    caretPosition: DEFAULT_CARET_POSITION,\n                    text: \"\".concat(currentTrigger).concat(item).concat(currentTrigger),\n                };\n            };\n        };\n        _this._getCurrentTriggerSettings = function (paramTrigger) {\n            var stateTrigger = _this.state.currentTrigger;\n            var currentTrigger = paramTrigger || stateTrigger;\n            if (!currentTrigger)\n                return null;\n            return _this.props.trigger[currentTrigger];\n        };\n        _this._getValuesFromProvider = function () {\n            var _a = _this.state, actualToken = _a.actualToken, currentTrigger = _a.currentTrigger;\n            var triggerSettings = _this._getCurrentTriggerSettings();\n            if (!currentTrigger || !triggerSettings)\n                return;\n            var component = triggerSettings.component, dataProvider = triggerSettings.dataProvider;\n            if (typeof dataProvider !== 'function') {\n                throw new Error('Trigger provider has to be a function!');\n            }\n            _this.setState({ dataLoading: true });\n            // Modified: send the full text to support / style commands\n            dataProvider(actualToken, _this.state.value, function (data, token) {\n                // Make sure that the result is still relevant for current query\n                if (token !== _this.state.actualToken)\n                    return;\n                if (!Array.isArray(data)) {\n                    throw new Error('Trigger provider has to provide an array!');\n                }\n                if (!isValidElementType(component)) {\n                    throw new Error('Component should be defined!');\n                }\n                // throw away if we resolved old trigger\n                if (currentTrigger !== _this.state.currentTrigger)\n                    return;\n                // if we haven't resolved any data let's close the autocomplete\n                if (!data.length) {\n                    _this._closeAutocomplete();\n                    return;\n                }\n                _this.setState({\n                    component: component,\n                    data: data,\n                    dataLoading: false,\n                });\n            });\n        };\n        _this._getSuggestions = function (paramTrigger) {\n            var _a = _this.state, stateTrigger = _a.currentTrigger, data = _a.data;\n            var currentTrigger = paramTrigger || stateTrigger;\n            if (!currentTrigger || !data || (data && !data.length))\n                return null;\n            return data;\n        };\n        /**\n         * Close autocomplete, also clean up trigger (to avoid slow promises)\n         */\n        _this._closeAutocomplete = function () {\n            _this.setState({\n                currentTrigger: null,\n                data: null,\n                dataLoading: false,\n                left: null,\n                top: null,\n            });\n        };\n        _this._cleanUpProps = function () {\n            var props = __assign({}, _this.props);\n            var notSafe = [\n                'additionalTextareaProps',\n                'className',\n                'closeCommandsList',\n                'closeMentionsList',\n                'closeOnClickOutside',\n                'containerClassName',\n                'containerStyle',\n                'disableMentions',\n                'dropdownClassName',\n                'dropdownStyle',\n                'grow',\n                'handleSubmit',\n                'innerRef',\n                'itemClassName',\n                'itemStyle',\n                'listClassName',\n                'listStyle',\n                'loaderClassName',\n                'loaderStyle',\n                'loadingComponent',\n                'minChar',\n                'movePopupAsYouType',\n                'onCaretPositionChange',\n                'onChange',\n                'ref',\n                'replaceWord',\n                'scrollToItem',\n                'shouldSubmit',\n                'showCommandsList',\n                'showMentionsList',\n                'SuggestionItem',\n                'SuggestionList',\n                'trigger',\n                'value',\n            ];\n            // eslint-disable-next-line\n            for (var prop in props) {\n                if (notSafe.includes(prop))\n                    delete props[prop];\n            }\n            return props;\n        };\n        _this._isCommand = function (text) {\n            if (text[0] !== '/')\n                return false;\n            var tokens = text.split(' ');\n            return tokens.length <= 1;\n        };\n        _this._changeHandler = function (e) {\n            var _a = _this.props, minChar = _a.minChar, movePopupAsYouType = _a.movePopupAsYouType, onCaretPositionChange = _a.onCaretPositionChange, onChange = _a.onChange, trigger = _a.trigger;\n            var _b = _this.state, left = _b.left, top = _b.top;\n            var textarea = e.target;\n            var selectionEnd = textarea.selectionEnd, selectionStart = textarea.selectionStart, value = textarea.value;\n            if (onChange) {\n                e.persist();\n                onChange(e);\n            }\n            if (onCaretPositionChange)\n                onCaretPositionChange(_this.getCaretPosition());\n            _this.setState({ value: value });\n            var currentTrigger;\n            var lastToken;\n            if (_this._isCommand(value)) {\n                currentTrigger = '/';\n                lastToken = value;\n            }\n            else {\n                var triggerTokens = Object.keys(trigger).join().replace('/', '');\n                var triggerNorWhitespace = \"[^\\\\s\".concat(triggerTokens, \"]*\");\n                var regex = new RegExp(\"(?!^|\\\\W)?[\".concat(triggerTokens, \"]\").concat(triggerNorWhitespace, \"\\\\s?\").concat(triggerNorWhitespace, \"$\"), 'g');\n                var tokenMatch = value.slice(0, selectionEnd).match(regex);\n                lastToken = tokenMatch && tokenMatch[tokenMatch.length - 1].trim();\n                currentTrigger = (lastToken && Object.keys(trigger).find(function (a) { return a === lastToken[0]; })) || null;\n            }\n            /*\n             if we lost the trigger token or there is no following character we want to close\n             the autocomplete\n            */\n            if (!lastToken || lastToken.length <= minChar) {\n                _this._closeAutocomplete();\n                return;\n            }\n            var actualToken = lastToken.slice(1);\n            // if trigger is not configured step out from the function, otherwise proceed\n            if (!currentTrigger)\n                return;\n            if (movePopupAsYouType ||\n                (top === null && left === null) ||\n                // if we have single char - trigger it means we want to re-position the autocomplete\n                lastToken.length === 1) {\n                var _c = getCaretCoordinates(textarea, selectionEnd), newLeft = _c.left, newTop = _c.top;\n                _this.setState({\n                    // make position relative to textarea\n                    left: newLeft,\n                    top: newTop - _this.textareaRef.scrollTop || 0,\n                });\n            }\n            _this.setState({\n                actualToken: actualToken,\n                currentTrigger: currentTrigger,\n                selectionEnd: selectionEnd,\n                selectionStart: selectionStart,\n            }, function () {\n                try {\n                    _this._getValuesFromProvider();\n                }\n                catch (err) {\n                    errorMessage(err.message);\n                }\n            });\n        };\n        _this._selectHandler = function (e) {\n            var _a = _this.props, onCaretPositionChange = _a.onCaretPositionChange, onSelect = _a.onSelect;\n            if (onCaretPositionChange)\n                onCaretPositionChange(_this.getCaretPosition());\n            if (onSelect) {\n                e.persist();\n                onSelect(e);\n            }\n        };\n        // The textarea itself is outside the auto-select dropdown.\n        _this._onClickAndBlurHandler = function (e) {\n            var _a = _this.props, closeOnClickOutside = _a.closeOnClickOutside, onBlur = _a.onBlur;\n            // If this is a click: e.target is the textarea, and e.relatedTarget is the thing\n            // that was actually clicked. If we clicked inside the auto-select dropdown, then\n            // that's not a blur, from the auto-select point of view, so then do nothing.\n            var el = e.relatedTarget;\n            // If this is a blur event in Safari, then relatedTarget is never a dropdown item, but a common parent\n            // of textarea and dropdown container. That means that dropdownRef will not contain its parent and the\n            // autocomplete will be closed before onclick handler can be invoked selecting an item.\n            // It seems that Safari has different implementation determining the relatedTarget node than Chrome and Firefox.\n            // Therefore, if focused away in Safari, the dropdown will be kept rendered until pressing Esc or selecting and item from it.\n            var focusedAwayInSafari = isSafari() && e.type === 'blur';\n            if ((_this.dropdownRef && el instanceof Node && _this.dropdownRef.contains(el)) ||\n                focusedAwayInSafari) {\n                return;\n            }\n            if (closeOnClickOutside)\n                _this._closeAutocomplete();\n            if (onBlur) {\n                e.persist();\n                onBlur(e);\n            }\n        };\n        _this._onScrollHandler = function () { return _this._closeAutocomplete(); };\n        _this._dropdownScroll = function (item) {\n            var scrollToItem = _this.props.scrollToItem;\n            if (!scrollToItem)\n                return;\n            if (scrollToItem === true) {\n                defaultScrollToItem(_this.dropdownRef, item);\n                return;\n            }\n            if (typeof scrollToItem !== 'function' || scrollToItem.length !== 2) {\n                throw new Error('`scrollToItem` has to be boolean (true for default implementation) or function with two parameters: container, item.');\n            }\n            scrollToItem(_this.dropdownRef, item);\n        };\n        _this.getTriggerProps = function () {\n            var _a = _this.props, showCommandsList = _a.showCommandsList, showMentionsList = _a.showMentionsList, trigger = _a.trigger;\n            var _b = _this.state, component = _b.component, currentTrigger = _b.currentTrigger, selectionEnd = _b.selectionEnd, value = _b.value;\n            var selectedItem = _this._getItemOnSelect();\n            var suggestionData = _this._getSuggestions();\n            var textToReplace = _this._getTextToReplace();\n            var triggerProps = {\n                component: component,\n                currentTrigger: currentTrigger,\n                getSelectedItem: selectedItem,\n                getTextToReplace: textToReplace,\n                selectionEnd: selectionEnd,\n                value: value,\n                values: suggestionData,\n            };\n            if ((showCommandsList && trigger['/']) || (showMentionsList && trigger['@'])) {\n                var currentCommands_1;\n                var getCommands = trigger[showCommandsList ? '/' : '@'].dataProvider;\n                getCommands === null || getCommands === void 0 ? void 0 : getCommands('', showCommandsList ? '/' : '@', function (data) {\n                    currentCommands_1 = data;\n                });\n                triggerProps.component = showCommandsList ? CommandItem : UserItem;\n                triggerProps.currentTrigger = showCommandsList ? '/' : '@';\n                triggerProps.getTextToReplace = _this._getTextToReplace(showCommandsList ? '/' : '@');\n                triggerProps.getSelectedItem = _this._getItemOnSelect(showCommandsList ? '/' : '@');\n                triggerProps.selectionEnd = 1;\n                triggerProps.value = showCommandsList ? '/' : '@';\n                triggerProps.values = currentCommands_1;\n            }\n            return triggerProps;\n        };\n        _this.setDropdownRef = function (element) {\n            _this.dropdownRef = element;\n        };\n        var _a = _this.props, loadingComponent = _a.loadingComponent, trigger = _a.trigger, value = _a.value;\n        // TODO: it would be better to have the parent control state...\n        // if (value) this.state.value = value;\n        if (!loadingComponent) {\n            throw new Error('RTA: loadingComponent is not defined');\n        }\n        if (!trigger) {\n            throw new Error('RTA: trigger is not defined');\n        }\n        _this.state = {\n            actualToken: '',\n            component: null,\n            currentTrigger: null,\n            data: null,\n            dataLoading: false,\n            isComposing: false,\n            left: null,\n            selectionEnd: 0,\n            selectionStart: 0,\n            top: null,\n            value: value || '',\n        };\n        return _this;\n    }\n    /**\n     * setup to emulate the UNSAFE_componentWillReceiveProps\n     */\n    ReactTextareaAutocomplete.getDerivedStateFromProps = function (props, state) {\n        if (props.value !== state.propsValue || !state.value) {\n            return { propsValue: props.value, value: props.value };\n        }\n        else {\n            return null;\n        }\n    };\n    ReactTextareaAutocomplete.prototype.renderSuggestionListContainer = function () {\n        var _a = this.props, disableMentions = _a.disableMentions, dropdownClassName = _a.dropdownClassName, dropdownStyle = _a.dropdownStyle, itemClassName = _a.itemClassName, itemStyle = _a.itemStyle, listClassName = _a.listClassName, SuggestionItem = _a.SuggestionItem, _b = _a.SuggestionList, SuggestionList = _b === void 0 ? DefaultSuggestionList : _b;\n        var isComposing = this.state.isComposing;\n        var triggerProps = this.getTriggerProps();\n        if (isComposing ||\n            !triggerProps.values ||\n            !triggerProps.currentTrigger ||\n            (disableMentions && triggerProps.currentTrigger === '@'))\n            return null;\n        return (React.createElement(\"div\", { className: clsx('rta__autocomplete', 'str-chat__suggestion-list-container', dropdownClassName), ref: this.setDropdownRef, style: dropdownStyle },\n            React.createElement(SuggestionList, __assign({ className: clsx('str-chat__suggestion-list', listClassName), dropdownScroll: this._dropdownScroll, itemClassName: clsx('str-chat__suggestion-list-item', itemClassName), itemStyle: itemStyle, onSelect: this._onSelect, SuggestionItem: SuggestionItem }, triggerProps))));\n    };\n    ReactTextareaAutocomplete.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, className = _a.className, containerClassName = _a.containerClassName, containerStyle = _a.containerStyle, style = _a.style;\n        var _b = this.props.additionalTextareaProps || {}, onBlur = _b.onBlur, onChange = _b.onChange, onClick = _b.onClick, onFocus = _b.onFocus, onKeyDown = _b.onKeyDown, onScroll = _b.onScroll, onSelect = _b.onSelect, restAdditionalTextareaProps = __rest(_b, [\"onBlur\", \"onChange\", \"onClick\", \"onFocus\", \"onKeyDown\", \"onScroll\", \"onSelect\"]);\n        var maxRows = this.props.maxRows;\n        var _c = this.state, dataLoading = _c.dataLoading, value = _c.value;\n        if (!this.props.grow)\n            maxRows = 1;\n        // By setting defaultValue to undefined, avoid error:\n        // ForwardRef(TextareaAutosize) contains a textarea with both value and defaultValue props.\n        // Textarea elements must be either controlled or uncontrolled\n        return (React.createElement(\"div\", { className: clsx('rta', containerClassName, {\n                'rta--loading': dataLoading,\n            }), style: containerStyle },\n            this.renderSuggestionListContainer(),\n            React.createElement(Textarea, __assign({ \"data-testid\": 'message-input' }, this._cleanUpProps(), { className: clsx('rta__textarea', className), maxRows: maxRows, onBlur: function (e) {\n                    _this._onClickAndBlurHandler(e);\n                    onBlur === null || onBlur === void 0 ? void 0 : onBlur(e);\n                }, onChange: function (e) {\n                    _this._changeHandler(e);\n                    onChange === null || onChange === void 0 ? void 0 : onChange(e);\n                }, onClick: function (e) {\n                    _this._onClickAndBlurHandler(e);\n                    onClick === null || onClick === void 0 ? void 0 : onClick(e);\n                }, onCompositionEnd: function () { return _this.setState(function (pv) { return (__assign(__assign({}, pv), { isComposing: false })); }); }, onCompositionStart: function () { return _this.setState(function (pv) { return (__assign(__assign({}, pv), { isComposing: true })); }); }, onFocus: function (e) {\n                    var _a, _b;\n                    (_b = (_a = _this.props).onFocus) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n                    onFocus === null || onFocus === void 0 ? void 0 : onFocus(e);\n                }, onKeyDown: function (e) {\n                    _this._handleKeyDown(e);\n                    onKeyDown === null || onKeyDown === void 0 ? void 0 : onKeyDown(e);\n                }, onScroll: function (e) {\n                    _this._onScrollHandler(e);\n                    onScroll === null || onScroll === void 0 ? void 0 : onScroll(e);\n                }, onSelect: function (e) {\n                    _this._selectHandler(e);\n                    onSelect === null || onSelect === void 0 ? void 0 : onSelect(e);\n                }, ref: function (ref) {\n                    var _a;\n                    (_a = _this.props) === null || _a === void 0 ? void 0 : _a.innerRef(ref);\n                    _this.textareaRef = ref;\n                }, style: style, value: value }, restAdditionalTextareaProps, { defaultValue: undefined }))));\n    };\n    ReactTextareaAutocomplete.defaultProps = {\n        closeOnClickOutside: true,\n        maxRows: 10,\n        minChar: 1,\n        movePopupAsYouType: false,\n        scrollToItem: true,\n        value: '',\n    };\n    return ReactTextareaAutocomplete;\n}(React.Component));\nexport { ReactTextareaAutocomplete };\nReactTextareaAutocomplete.propTypes = {\n    className: PropTypes.string,\n    closeOnClickOutside: PropTypes.bool,\n    containerClassName: PropTypes.string,\n    containerStyle: PropTypes.object,\n    disableMentions: PropTypes.bool,\n    dropdownClassName: PropTypes.string,\n    dropdownStyle: PropTypes.object,\n    itemClassName: PropTypes.string,\n    itemStyle: PropTypes.object,\n    listClassName: PropTypes.string,\n    listStyle: PropTypes.object,\n    loaderClassName: PropTypes.string,\n    loaderStyle: PropTypes.object,\n    loadingComponent: PropTypes.elementType,\n    minChar: PropTypes.number,\n    onBlur: PropTypes.func,\n    onCaretPositionChange: PropTypes.func,\n    onChange: PropTypes.func,\n    onSelect: PropTypes.func,\n    shouldSubmit: PropTypes.func,\n    style: PropTypes.object,\n    SuggestionList: PropTypes.elementType,\n    trigger: triggerPropsCheck,\n    value: PropTypes.string,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}